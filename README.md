# TCPrax

TCPrax is a modular TCP reconnaissance framework written in Python.
It implements low-level port scanning techniques and service fingerprinting, including TLS-aware banner extraction.

The project demonstrates protocol-level understanding of TCP, raw socket packet crafting, timeout calibration, encrypted service detection, and kernel interaction behavior.

---

## Overview

TCPrax provides:

- **TCP Connect Scan (-sT)**
- **TCP SYN Half-Open Scan (-sS)**
- **Open Port Detection**
- **Service Banner Grabbing**
- **TLS Handshake Detection for Encrypted Services**
- **CLI-Based Scan Control**
- **Modular Architecture (Core, Service, CLI Layers)**

---

## Architecture

```
tcprax/
│
├── main.py
├── cli.py
│
├── core/
│   ├── connect_scan.py
│   ├── syn_scan.py
│   ├── create_syn_packet.py
│   └── timeout_calculation.py
│
└── service/
    └── banner.py
```

Design principles:

- Strict separation of concerns
- Raw packet crafting isolated from scan orchestration
- Structured return values (no print logic inside engines)
- Extensible architecture for future protocols

---

## Features

### 1. TCP Connect Scan (-sT)

- Uses standard socket `connect()`
- Determines port state via connection result
- RTT-based timeout calibration
- Does not require root privileges

---

### 2. TCP SYN Half-Open Scan (-sS)

- Manual TCP header construction
- Raw socket transmission
- Pseudo-header checksum calculation
- Response classification:
    - SYN-ACK → OPEN
    - RST → CLOSED
    - No response → FILTERED

Requires root privileges.

---

## Important: RST Suppression Requirement (For SYN Scan)

When performing raw SYN scans, the Linux kernel will automatically send a RST packet in response to unsolicited SYN-ACK replies.
This interferes with half-open scan behavior.

To prevent the kernel from terminating the handshake, you must temporarily drop outbound RST packets from the source port range used by TCPrax.

### Enable RST Drop Rule

```bash
sudo iptables -A OUTPUT -p tcp --tcp-flags RST RST --sport 50000:50500 -j DROP
```

### Disable RST Drop Rule (After Scan)

```bash
sudo iptables -D OUTPUT -p tcp --tcp-flags RST RST --sport 50000:50500 -j DROP
```

Explanation:

- The rule blocks outbound RST packets generated by the kernel.
- Source port range (50000–50500) must match the ephemeral ports used by the SYN scanner.
- Without this rule, the kernel will close connections prematurely, invalidating half-open semantics.

Failure to apply this rule may result in inaccurate scan results.

---

### 3. Service Banner Grabbing

- Passive banner extraction
- Protocol-aware active probing
- Regex-based service fingerprinting

Supported detection includes:

- HTTP / HTTPS
- FTP
- SSH
- SMTP
- Other common TCP services

---

### 4. TLS Handshake Detection

If a service is encrypted:

- Initiates SSL/TLS handshake
- Extracts certificate Common Name (CN)
- Identifies negotiated TLS version
- Attempts HTTPS probing when applicable

Improves detection accuracy for encrypted endpoints.

---

## Installation

Requirements:

- Python 3.9+
- Linux (recommended)
- Root privileges for SYN scan
- iptables access (for RST suppression)

Clone repository:

```bash
git clone git@github.com:NakshatraSirohi/TCPrax.git
cd TCPrax
```

No third-party dependencies required.

---

## Usage

### Connect Scan

```bash
python main.py <IPv4/Domain> -sT
```

### SYN Half-Open Scan

```bash
sudo python main.py <IPv4/Domain> -sS
```

### With Service Detection

```bash
sudo python main.py <IPv4/Domain> -sS --service
```

### Port Range

```bash
sudo python main.py <IPv4/Domain> -sS --ports 1-1000
```

---

## Technical Notes

- Adaptive timeout calculation based on RTT sampling.
- Explicit TCP checksum computation using pseudo-header.
- TLS detection implemented using Python `ssl` context wrapping.
- Modular scan engine abstraction enables future protocol extensions.

---

## Limitations

- SYN scan requires root privileges.
- Linux-focused implementation.
- No concurrency (currently synchronous).
- No UDP scan support.
- No OS fingerprinting.

---

## Ethical Use Disclaimer

This tool is intended strictly for:

- Educational purposes
- Authorized penetration testing
- Controlled lab environments

Unauthorized scanning may violate laws and network policies.

---

## Version

Current stable release: **v1.0.0**

---

## License

MIT License

---

## Project Intent

TCPrax is not intended to compete with mature tools.
It exists to demonstrate:

- Protocol-level understanding of TCP
- Raw socket engineering
- Encrypted service inspection
- Clean modular software design
- Disciplined Git workflow and version control

It is a systems-oriented networking project, not a scripting exercise.
