# TCPrax

TCPrax is a modular TCP reconnaissance framework written in Python.

It implements both TCP Connect and raw SYN half-open scanning with thread-based concurrency, adaptive RTT-driven timeout calibration, and TLS-aware service fingerprinting.

The project demonstrates low-level TCP packet construction, raw socket handling, kernel RST interaction management, and performance-aware scan orchestration with runtime metrics reporting.

---

## Overview

TCPrax provides:

- **TCP Connect Scan (-sT)**
- **TCP SYN Half-Open Scan (-sS)**
- **Multithreaded Port Scanning**
- **Adaptive Timeout Calibration (RTT-Based)**
- **Service Banner & Version Detection (-sV)**
- **TLS Handshake Detection for Encrypted Services**
- **Runtime Metrics & Performance Summary**
- **CLI-Based Scan Control**
- **Modular Architecture (Core, Service, CLI Layers)**

---

## Architecture

```
tcprax/
│
├── main.py
├── cli.py
│
├── core/
│   ├── connect_scan.py
│   ├── syn_scan.py
│   ├── create_syn_packet.py
│   └── timeout_calculation.py
│
└── service/
    └── banner.py
```

Design principles:

- Strict separation of concerns
- Raw packet crafting isolated from scan orchestration
- Structured return values (no print logic inside engines)
- Extensible architecture for future protocols

---

## Features

### 1. TCP Connect Scan (-sT)

- Uses standard socket `connect_ex()`
- Determines port state via connection result
- RTT-based timeout calibration
- Does not require root privileges

### 2. TCP SYN Half-Open Scan (-sS)

- Manual TCP header construction
- Raw socket transmission
- Pseudo-header checksum calculation
- Response classification:
    - SYN-ACK → OPEN
    - RST → CLOSED
    - No response → FILTERED

Requires root privileges & manual RST suppression via iptables.

### 3. Service Banner Grabbing

- Passive banner extraction
- Protocol-aware active probing
- Regex-based service fingerprinting

Supported detection includes:

- HTTP / HTTPS
- FTP
- SSH
- SMTP
- Other common TCP services

### 4. TLS Handshake Detection

If a service is encrypted:

- Initiates SSL/TLS handshake
- Identifies negotiated TLS version
- Attempts HTTPS probing when applicable

Improves detection accuracy for encrypted endpoints.

### 5. Multithreaded Scanning

TCPrax uses Python's `ThreadPoolExecutor` to perform concurrent port scanning.

- Configurable thread count via `-t / --threads`
- Parallel scanning for both TCP Connect and SYN modes
- Results aggregated safely and sorted by port

Thread count validation:

- Minimum: 1
- Maximum: 300 (to prevent resource exhaustion)

Recommended range: 50–200 threads depending on system capability.

### 6. Runtime Metrics Summary

TCPrax displays scan statistics before and after execution:

**Pre-scan summary:**

- Target hostname
- Resolved IP
- Scan type
- Threads used
- Total ports
- Service detection status

**Post-scan metrics:**

- Total execution time
- Scan rate (ports/sec)
- Open / Closed / Filtered port counts

This provides operational visibility and performance insight.

---

## Important: RST Suppression Requirement (For SYN Scan)

When performing raw SYN scans, the Linux kernel will automatically send a RST packet in response to unsolicited SYN-ACK replies.
This interferes with half-open scan behavior.

To prevent the kernel from terminating the handshake, you must temporarily drop outbound RST packets from the source port range used by TCPrax.

### Enable RST Drop Rule (Before Scan)

```bash
sudo iptables -A OUTPUT -p tcp --tcp-flags RST RST --sport 50000:51000 -j DROP
```

### Disable RST Drop Rule (After Scan)

```bash
sudo iptables -D OUTPUT -p tcp --tcp-flags RST RST --sport 50000:51000 -j DROP
```

Explanation:

- The rule blocks outbound RST packets generated by the kernel.
- Source port range (50000–51000) must match the ephemeral ports used by the SYN scanner.
- Without this rule, the kernel will close connections prematurely, invalidating half-open semantics.

Failure to apply this rule may result in inaccurate scan results.

---

## CLI Options

| Option         | Description                                |
| -------------- | ------------------------------------------ |
| -sT            | TCP Connect Scan                           |
| -sS            | TCP SYN Half-Open Scan (requires root)     |
| -sV            | Enable service/version detection           |
| -p / --ports   | Port range (e.g. 1-1000, 22,80,443)        |
| -t / --threads | Number of concurrent threads (default: 20) |

---

## Installation

Requirements:

- Python 3.9+
- Linux (recommended)
- Root privileges for SYN scan
- iptables access (for RST suppression)

Clone repository:

```bash
git clone git@github.com:NakshatraSirohi/TCPrax.git
cd TCPrax
```

No third-party dependencies required.

---

## Usage

### Connect Scan

```bash
python main.py <IPv4/Domain> -sT -p 1-500 -t 10
```

### SYN Half-Open Scan

```bash
sudo python main.py <IPv4/Domain> -sS -p 1-1000 -t 50
```

### With Service Detection

```bash
sudo python main.py <IPv4/Domain> -sS -p 1-2000 -sV -t 100
```

### Example Output

```
=== TCPrax Scan Summary ===
Target : example.com
Resolved IP : 93.184.216.34
Scan Type : TCP SYN Scan (-sS)
Threads Used : 100
Total Ports : 1000
Service Detect : Enabled

2/tcp CLOSED
13/tcp CLOSED
19/tcp CLOSED
22/tcp OPEN
80/tcp OPEN
443/tcp OPEN
500/tcp FILTERED
... [SNIP] ...

=== Scan Completed ===
Total Time : 7.55 seconds
Scan Rate : 132.52 ports/sec
Open Ports : 10
Closed Ports : 960
Filtered Ports : 30
```

---

## Technical Notes

- Adaptive timeout calculation based on median RTT sampling and bounded within safe limits.
- Thread-based concurrency using `ThreadPoolExecutor` for parallel port scanning.
- Explicit TCP header construction with pseudo-header checksum calculation (SYN scan).
- Raw socket handling for half-open scanning with manual packet parsing.
- TLS detection implemented using Python `ssl` context wrapping.
- Runtime metrics reporting (execution time, scan rate, port state distribution).
- Kernel RST suppression required to preserve half-open semantics.
- Modular scan engine abstraction enabling extensibility (e.g., UDP scan, OS fingerprinting).

---

## Limitations

- High thread counts may exhaust system file descriptors.
- SYN scan requires raw socket permissions.
- Requires manual RST suppression via iptables.
- Linux-focused implementation.
- No UDP scan support.
- No OS fingerprinting.

---

## Performance Considerations

- Increasing thread count improves scan speed but increases system load.
- SYN scan performance depends on network latency and kernel handling.
- Timeout is dynamically calibrated based on measured RTT.
- Extremely high thread counts (>300) are blocked to prevent instability.

---

## Ethical Use Disclaimer

This tool is intended strictly for:

- Educational purposes
- Authorized penetration testing
- Controlled lab environments

Unauthorized scanning may violate laws and network policies.

---

## Version

Current release: **v1.1.1**

---

## License

MIT License

---

## Project Intent

TCPrax is not intended to compete with mature tools.
It exists to demonstrate:

- Protocol-level understanding of TCP
- Raw socket engineering
- Encrypted service inspection
- Clean modular software design
- Disciplined Git workflow and version control

It is a systems-oriented networking project, not a scripting exercise.
